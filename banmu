--==================================================
-- HACKBORY V7 - ESP | AURA | NEW SYSTEM LASER (ANTI-INVISIBLE)
--==================================================

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local Workspace = game:GetService("Workspace")
local LP = Players.LocalPlayer

-- TOGGLE
local ESP_ON, NAME_ON, LASER_ON = true, true, true

-- ALPHA RIÃŠNG
local ESP_ALPHA = 100
local AURA_ALPHA = 100
local LASER_ALPHA = 100

-- Cáº¤U HÃŒNH LASER Má»šI (Tá»« mÃ£ nguá»“n báº¡n cung cáº¥p)
local LASER_CONFIG = {
	Color = Color3.fromRGB(255, 255, 0), -- MÃ u vÃ ng
	WidthStart = 0.2,
	WidthEnd = 0.05,
	Length = 150,
	OffSet = Vector3.new(1.5, -0.5, 0) -- Lá»‡ch pháº£i
}

-- Táº O FOLDER CHá»¨A LASER (ANTI-INVISIBLE)
local LaserFolder = Workspace:FindFirstChild("System_Laser")
if not LaserFolder then
	LaserFolder = Instance.new("Folder", Workspace)
	LaserFolder.Name = "System_Laser"
end

local function trans(v)
	return math.clamp(1 - (v / 100), 0, 1)
end

--================ GUI SETUP (GIá»® NGUYÃŠN) =================
local gui = Instance.new("ScreenGui")
gui.Name = "HACKBORY_GUI_V7_NEW"
gui.Parent = game.CoreGui
gui.ResetOnSpawn = false

-- Avatar ID
local AVATAR_ID = "rbxassetid://133760055685849"

-- Open Button
local openButton = Instance.new("ImageButton")
openButton.Size = UDim2.fromOffset(80, 80)
openButton.Position = UDim2.new(0, 30, 0.5, -40)
openButton.AnchorPoint = Vector2.new(0, 0.5)
openButton.BackgroundTransparency = 1
openButton.Image = AVATAR_ID
openButton.Parent = gui

local openCorner = Instance.new("UICorner")
openCorner.CornerRadius = UDim.new(1, 0)
openCorner.Parent = openButton

local openStrokeOuter = Instance.new("UIStroke")
openStrokeOuter.Thickness = 6
openStrokeOuter.Color = Color3.fromRGB(255, 80, 80)
openStrokeOuter.Transparency = 0.3
openStrokeOuter.Parent = openButton

-- Frame chÃ­nh
local frame = Instance.new("Frame")
frame.Size = UDim2.fromOffset(620, 220)
frame.Position = UDim2.new(0, 120, 0.5, -110)
frame.AnchorPoint = Vector2.new(0, 0.5)
frame.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
frame.BackgroundTransparency = 0.05
frame.Visible = false
frame.Active = true
frame.Draggable = true
frame.BorderSizePixel = 0
frame.Parent = gui

local frameCorner = Instance.new("UICorner")
frameCorner.CornerRadius = UDim.new(0, 20)
frameCorner.Parent = frame

local frameStroke = Instance.new("UIStroke")
frameStroke.Thickness = 3
frameStroke.Color = Color3.fromRGB(255, 80, 80)
frameStroke.Transparency = 0.2
frameStroke.Parent = frame

local frameGrad = Instance.new("UIGradient")
frameGrad.Color = ColorSequence.new{
	ColorSequenceKeypoint.new(0, Color3.fromRGB(30, 30, 40)),
	ColorSequenceKeypoint.new(1, Color3.fromRGB(10, 10, 20))
}
frameGrad.Rotation = 45
frameGrad.Parent = frame

-- Title
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, -100, 0, 50)
title.Position = UDim2.new(0, 20, 0, 10)
title.BackgroundTransparency = 1
title.Text = "HACKBORY V7 â€“ NEW SYSTEM LASER"
title.TextColor3 = Color3.fromRGB(255, 120, 120)
title.TextScaled = true
title.Font = Enum.Font.GothamBold
title.Parent = frame

-- Close Button
local closeButton = Instance.new("ImageButton")
closeButton.Size = UDim2.fromOffset(50, 50)
closeButton.Position = UDim2.new(1, -70, 0, 15)
closeButton.BackgroundTransparency = 1
closeButton.Image = AVATAR_ID
closeButton.Parent = frame
local closeCorner = Instance.new("UICorner")
closeCorner.CornerRadius = UDim.new(1, 0)
closeCorner.Parent = closeButton

-- Animation GUI
local function openAnim()
	frame.Visible = true
	frame.Size = UDim2.fromOffset(0, 220)
	TweenService:Create(frame, TweenInfo.new(0.4, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {Size = UDim2.fromOffset(620, 220)}):Play()
end
local function closeAnim()
	TweenService:Create(frame, TweenInfo.new(0.3, Enum.EasingStyle.Quint), {Size = UDim2.fromOffset(0, 220)}):Play()
	task.delay(0.3, function() frame.Visible = false; openButton.Visible = true end)
end
openButton.MouseButton1Click:Connect(function() openButton.Visible = false; openAnim() end)
closeButton.MouseButton1Click:Connect(closeAnim)

-- Toggles & Inputs
local function createToggle(text, xPos, callback)
	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(0, 180, 0, 45)
	btn.Position = UDim2.new(0, xPos, 0, 70)
	btn.Text = text .. ": ON"
	btn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
	btn.TextColor3 = Color3.new(1, 1, 1)
	btn.TextScaled = true
	btn.Font = Enum.Font.GothamBold
	btn.Parent = frame
	local btnCorner = Instance.new("UICorner"); btnCorner.CornerRadius = UDim.new(0, 12); btnCorner.Parent = btn
	
	local on = true
	btn.MouseButton1Click:Connect(function()
		on = not on
		btn.Text = text .. ": " .. (on and "ON" or "OFF")
		btn.BackgroundColor3 = on and Color3.fromRGB(255, 80, 80) or Color3.fromRGB(30, 30, 30)
		callback(on)
	end)
end

local function createInput(label, xPos, default, callback)
	local box = Instance.new("TextBox")
	box.Size = UDim2.new(0, 180, 0, 40)
	box.Position = UDim2.new(0, xPos, 0, 135)
	box.PlaceholderText = label
	box.Text = tostring(default)
	box.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
	box.TextColor3 = Color3.new(1, 1, 1)
	box.TextScaled = true
	box.Font = Enum.Font.Gotham
	box.Parent = frame
	local boxCorner = Instance.new("UICorner"); boxCorner.CornerRadius = UDim.new(0, 10); boxCorner.Parent = box
	box.FocusLost:Connect(function(enter)
		if enter then
			local v = tonumber(box.Text)
			if v then callback(math.clamp(v, 1, 100)) end
		end
	end)
end

createToggle("ESP + AURA", 30, function(v) ESP_ON = v end)
createToggle("NAME", 230, function(v) NAME_ON = v end)
createToggle("LASER", 430, function(v) LASER_ON = v end) -- Toggle Laser

createInput("ESP Äáº­m", 30, ESP_ALPHA, function(v) ESP_ALPHA = v end)
createInput("AURA Äáº­m", 230, AURA_ALPHA, function(v) AURA_ALPHA = v end)
createInput("LASER Äáº­m", 430, LASER_ALPHA, function(v) LASER_ALPHA = v end) -- Input Alpha

--================ WARNING SYSTEM (NHá»Ž Gá»ŒN) =================
local warningLabel = Instance.new("TextLabel")
warningLabel.Size = UDim2.new(0, 200, 0, 30)
warningLabel.Position = UDim2.new(0.5, 0, 0.05, 0)
warningLabel.AnchorPoint = Vector2.new(0.5, 0)
warningLabel.BackgroundTransparency = 0.3
warningLabel.BackgroundColor3 = Color3.fromRGB(30, 0, 0)
warningLabel.Text = "âš ï¸ LASER NHáº®M VÃ€O Báº N âš ï¸"
warningLabel.TextColor3 = Color3.fromRGB(255, 80, 80)
warningLabel.TextScaled = true
warningLabel.Font = Enum.Font.GothamBold
warningLabel.Visible = false
warningLabel.Parent = gui
local warningCorner = Instance.new("UICorner"); warningCorner.CornerRadius = UDim.new(0, 12); warningCorner.Parent = warningLabel

local function setWarning(visible)
	warningLabel.Visible = visible
end

--================ HÃ€M Xá»¬ LÃ LOGIC Má»šI =================

-- 1. HÃ€M XÃ“A LASER
local function CleanupLaser(plrName)
	local beam = LaserFolder:FindFirstChild("BEAM_" .. plrName)
	if beam then beam:Destroy() end
	local target = LaserFolder:FindFirstChild("TARGET_" .. plrName)
	if target then target:Destroy() end
end

-- 2. HÃ€M Cáº¬P NHáº¬T LASER (Dá»±a trÃªn code má»›i cá»§a báº¡n)
local function UpdateLaser(plr)
	-- Náº¿u táº¯t Laser hoáº·c nhÃ¢n váº­t lá»—i -> XÃ³a
	if not LASER_ON or not plr.Character or not plr.Character:FindFirstChild("HumanoidRootPart") or not plr.Character:FindFirstChild("Humanoid") or plr.Character.Humanoid.Health <= 0 then
		CleanupLaser(plr.Name)
		return
	end

	local hrp = plr.Character.HumanoidRootPart

	-- Táº¡o Ä‘iá»ƒm xuáº¥t phÃ¡t trÃªn ngÆ°á»i chÆ¡i
	local att0 = hrp:FindFirstChild("LASER_SRC")
	if not att0 then
		att0 = Instance.new("Attachment", hrp)
		att0.Name = "LASER_SRC"
		att0.Position = LASER_CONFIG.OffSet
	end

	-- Táº¡o Ä‘iá»ƒm Ä‘Ã­ch trong Folder
	local att1 = LaserFolder:FindFirstChild("TARGET_" .. plr.Name)
	if not att1 then
		att1 = Instance.new("Attachment", LaserFolder)
		att1.Name = "TARGET_" .. plr.Name
	end
	
	-- Cáº­p nháº­t Ä‘Ã­ch Ä‘áº¿n
	att1.WorldPosition = att0.WorldPosition + hrp.CFrame.LookVector * LASER_CONFIG.Length

	-- Táº¡o/Cáº­p nháº­t Beam
	local beam = LaserFolder:FindFirstChild("BEAM_" .. plr.Name)
	if not beam then
		beam = Instance.new("Beam", LaserFolder)
		beam.Name = "BEAM_" .. plr.Name
		beam.Attachment0 = att0
		beam.Attachment1 = att1
		beam.Color = ColorSequence.new(LASER_CONFIG.Color)
		beam.Width0 = LASER_CONFIG.WidthStart
		beam.Width1 = LASER_CONFIG.WidthEnd
		beam.FaceCamera = true
		beam.LightEmission = 1
		beam.LightInfluence = 0
	end

	-- Ãp dá»¥ng Ä‘á»™ má» tá»« GUI (LASER_ALPHA)
	beam.Transparency = NumberSequence.new(trans(LASER_ALPHA))
	beam.Enabled = true
end

-- 3. HÃ€M TÃNH KHOáº¢NG CÃCH CHO WARNING
local function pointToLineDistance(point, lineStart, lineEnd)
	local lineVec = lineEnd - lineStart
	local lineLen = lineVec.Magnitude
	if lineLen == 0 then return (point - lineStart).Magnitude end
	local lineDir = lineVec.Unit
	local toPoint = point - lineStart
	local proj = math.clamp(toPoint:Dot(lineDir), 0, lineLen)
	local closest = lineStart + lineDir * proj
	return (point - closest).Magnitude
end

-- 4. KIá»‚M TRA LASER CÃ“ NHáº®M VÃ€O MÃŒNH KHÃ”NG (Cáº¬P NHáº¬T THEO SYSTEM Má»šI)
local function isLaserAimingAtMe(plr)
	-- TÃ¬m Beam trong Folder thay vÃ¬ trÃªn ngÆ°á»i chÆ¡i
	local beam = LaserFolder:FindFirstChild("BEAM_" .. plr.Name)
	if not beam or not beam.Attachment0 or not beam.Attachment1 then return false end
	
	local startPos = beam.Attachment0.WorldPosition
	local endPos = beam.Attachment1.WorldPosition
	
	local lpChar = LP.Character
	if not lpChar then return false end
	local lpHrp = lpChar:FindFirstChild("HumanoidRootPart")
	if not lpHrp then return false end
	
	-- TÃ­nh toÃ¡n khoáº£ng cÃ¡ch (NgÆ°á»¡ng 5 studs)
	local dist = pointToLineDistance(lpHrp.Position, startPos, endPos)
	return dist < 5
end

--================ ESP & NAME LOGIC (GIá»® NGUYÃŠN) =================
local function applyESP(char)
	for _, p in pairs(char:GetChildren()) do
		if p:IsA("BasePart") then
			local box = p:FindFirstChild("ESP_BOX")
			if ESP_ON then
				if not box then
					box = Instance.new("BoxHandleAdornment", p)
					box.Name = "ESP_BOX"; box.Adornee = p; box.AlwaysOnTop = true
					box.Size = p.Size + Vector3.new(0.1, 0.1, 0.1)
					box.Color3 = Color3.fromRGB(255, 0, 0); box.Transparency = 0.5
				end
				box.Transparency = trans(ESP_ALPHA); box.Visible = true
			elseif box then box.Visible = false end
		end
	end
	local hl = char:FindFirstChild("ESP_HL")
	if ESP_ON then
		if not hl then
			hl = Instance.new("Highlight", char)
			hl.Name = "ESP_HL"; hl.FillColor = Color3.fromRGB(255, 0, 0); hl.OutlineColor = Color3.fromRGB(255, 100, 100)
		end
		hl.FillTransparency = trans(AURA_ALPHA); hl.OutlineTransparency = math.clamp(trans(AURA_ALPHA) - 0.3, 0, 1); hl.Enabled = true
	elseif hl then hl.Enabled = false end
end

local function applyName(char, plr)
	local head = char:FindFirstChild("Head")
	if not head then return end
	local tag = char:FindFirstChild("NAME_TAG")
	if NAME_ON then
		if not tag then
			tag = Instance.new("BillboardGui", char); tag.Name = "NAME_TAG"; tag.Adornee = head
			tag.Size = UDim2.new(0, 200, 0, 50); tag.StudsOffset = Vector3.new(0, 3, 0); tag.AlwaysOnTop = true
			local txt = Instance.new("TextLabel", tag); txt.Size = UDim2.fromScale(1, 1); txt.BackgroundTransparency = 1
			txt.Text = plr.DisplayName; txt.TextColor3 = Color3.fromRGB(0, 255, 100); txt.TextScaled = true; txt.Font = Enum.Font.GothamBold
			local stroke = Instance.new("UIStroke", txt); stroke.Color = Color3.new(0,0,0); stroke.Thickness = 2
		end
		tag.Enabled = true
	elseif tag then tag.Enabled = false end
end

--================ VÃ’NG Láº¶P CHÃNH =================
RunService.RenderStepped:Connect(function()
	local aimingAtMe = false
	
	for _, plr in pairs(Players:GetPlayers()) do
		if plr ~= LP and plr.Character then
			-- 1. ESP & NAME
			applyESP(plr.Character)
			applyName(plr.Character, plr)
			
			-- 2. LASER Má»šI (ANTI-INVISIBLE)
			UpdateLaser(plr)
			
			-- 3. CHECK WARNING
			if LASER_ON and isLaserAimingAtMe(plr) then
				aimingAtMe = true
			end
		end
	end
	
	setWarning(aimingAtMe)
end)

-- Dá»ŒN Dáº¸P KHI NGÆ¯á»œI CHÆ I THOÃT
Players.PlayerRemoving:Connect(function(plr)
	CleanupLaser(plr.Name)
end)

print("ðŸ”¥ HACKBORY V7 â€“ NEW SYSTEM LASER INTEGRATED ðŸ”¥")